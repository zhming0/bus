<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>@node-ts/bus-messages | @node-ts/bus</title>
    <meta name="description" content="Enterprise message bus library for typescript">
    
    
    <link rel="preload" href="/bus/assets/css/0.styles.e5b324c2.css" as="style"><link rel="preload" href="/bus/assets/js/app.a26ebe03.js" as="script"><link rel="preload" href="/bus/assets/js/9.25fc9bcf.js" as="script"><link rel="prefetch" href="/bus/assets/js/10.df59cb5e.js"><link rel="prefetch" href="/bus/assets/js/11.053fff12.js"><link rel="prefetch" href="/bus/assets/js/12.e52461bd.js"><link rel="prefetch" href="/bus/assets/js/13.51605591.js"><link rel="prefetch" href="/bus/assets/js/14.ead65cb8.js"><link rel="prefetch" href="/bus/assets/js/15.03c70588.js"><link rel="prefetch" href="/bus/assets/js/16.1d8f5c30.js"><link rel="prefetch" href="/bus/assets/js/17.dee4e52f.js"><link rel="prefetch" href="/bus/assets/js/18.aad36138.js"><link rel="prefetch" href="/bus/assets/js/2.afc26b7e.js"><link rel="prefetch" href="/bus/assets/js/3.a254d9fb.js"><link rel="prefetch" href="/bus/assets/js/4.bef9ce78.js"><link rel="prefetch" href="/bus/assets/js/5.a22c922c.js"><link rel="prefetch" href="/bus/assets/js/6.e323f766.js"><link rel="prefetch" href="/bus/assets/js/7.d60115d1.js"><link rel="prefetch" href="/bus/assets/js/8.559dd821.js">
    <link rel="stylesheet" href="/bus/assets/css/0.styles.e5b324c2.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/bus/" class="home-link router-link-active"><!----> <span class="site-name">@node-ts/bus</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/bus/" class="nav-link">Home</a></div><div class="nav-item"><a href="/bus/packages/bus-core/src/handler/" class="nav-link">Handlers</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Transports</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/bus/packages/bus-sqs/" class="nav-link">SQS</a></li><li class="dropdown-item"><!----> <a href="/bus/packages/bus-rabbitmq/" class="nav-link">RabbitMQ</a></li></ul></div></div><div class="nav-item"><a href="/bus/packages/bus-workflow/" class="nav-link">Workflows</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Persistence</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/bus/packages/bus-postgres/" class="nav-link">Postgres</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/node-ts/bus" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/bus/" class="nav-link">Home</a></div><div class="nav-item"><a href="/bus/packages/bus-core/src/handler/" class="nav-link">Handlers</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Transports</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/bus/packages/bus-sqs/" class="nav-link">SQS</a></li><li class="dropdown-item"><!----> <a href="/bus/packages/bus-rabbitmq/" class="nav-link">RabbitMQ</a></li></ul></div></div><div class="nav-item"><a href="/bus/packages/bus-workflow/" class="nav-link">Workflows</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Persistence</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/bus/packages/bus-postgres/" class="nav-link">Postgres</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/node-ts/bus" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/bus/" class="sidebar-link">Home</a></li><li><a href="/bus/packages/bus-messages/" class="active sidebar-link">Messages</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/bus/packages/bus-messages/#command" class="sidebar-link">Command</a></li><li class="sidebar-sub-header"><a href="/bus/packages/bus-messages/#event" class="sidebar-link">Event</a></li><li class="sidebar-sub-header"><a href="/bus/packages/bus-messages/#usage" class="sidebar-link">Usage</a></li></ul></li><li><a href="/bus/packages/bus-core/src/handler/" class="sidebar-link">Handlers</a></li><li><a href="/bus/packages/bus-core/src/transport/" class="sidebar-link">Transports</a></li><li><a href="/bus/packages/bus-workflow/" class="sidebar-link">Workflows</a></li><li><a href="/bus/packages/bus-workflow/src/workflow/persistence/" class="sidebar-link">Persistence</a></li></ul> </div> <div class="page"> <div class="content"><h1 id="node-ts-bus-messages"><a href="#node-ts-bus-messages" aria-hidden="true" class="header-anchor">#</a> @node-ts/bus-messages</h1> <p><a href="https://greenkeeper.io/" target="_blank" rel="noopener noreferrer"><img src="https://badges.greenkeeper.io/node-ts/bus.svg" alt="Greenkeeper badge"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> <a href="https://circleci.com/gh/node-ts/bus/tree/master" target="_blank" rel="noopener noreferrer"><img src="https://circleci.com/gh/node-ts/bus/tree/master.svg?style=svg" alt="CircleCI"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><a href="https://opensource.org/licenses/MIT" target="_blank" rel="noopener noreferrer"><img src="https://img.shields.io/badge/License-MIT-green.svg" alt="License: MIT"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>This package should be consumed wherever your application defines message contracts. Messages are small pieces of data that get passed around between services. They can define an instruction to perform an action, or report that something has just occurred.</p> <p><code>@node-ts/bus-messages</code> defines two types of messages:</p> <h2 id="command"><a href="#command" aria-hidden="true" class="header-anchor">#</a> Command</h2> <p>Commands are a type of message that represents an instruction to do work. These can be technical instructions such as <code>BackupDatabase</code>, <code>ScaleOutLoadBalancer</code>, or modeled after your business domains like <code>ChargeCreditCard</code>, <code>PostMerchandise</code>.</p> <p>Commands should be named as an instruction, using plain english. The above commands are understandable in plain English that they will do some sort of action.</p> <p>To implement a comamnd, simply extend <code>Command</code> and add in the fields that are relevant to it:</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Command <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@node-ts/bus-messages'</span>

<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">ChargeCreditCard</span> <span class="token keyword">extends</span> <span class="token class-name">Command</span> <span class="token punctuation">{</span>
  <span class="token comment">/**
   * A unique name that identifies the message. This should be done in namespace style syntax,
   * ie: organisation/domain/command-name
   */</span>
  $name <span class="token operator">=</span> <span class="token string">'my-app/accounts/charge-credit-card'</span>

  <span class="token comment">/**
   * The contract version of this message. This can be incremented if this message changes the
   * number of properties etc to maintain backwards compatibility
   */</span>
  $version <span class="token operator">=</span> <span class="token number">1</span>

  <span class="token comment">/**
   * Create a charge on a credit card
   * @param creditCardId the card to charge
   * @param amount the amount, in USD, to charge the card for
   */</span>
  <span class="token keyword">constructor</span> <span class="token punctuation">(</span>
    <span class="token parameter"><span class="token keyword">readonly</span> creditCardId<span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
    <span class="token keyword">readonly</span> amount<span class="token punctuation">:</span> <span class="token builtin">number</span></span>
  <span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><p>To send a command, just use <code>bus.send()</code>, eg:</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Bus <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@node-ts/bus-core'</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">chargeCreditCard</span> <span class="token punctuation">(</span>
  <span class="token parameter">bus<span class="token punctuation">:</span> Bus<span class="token punctuation">,</span>
  creditCardId<span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
  amount<span class="token punctuation">:</span> <span class="token builtin">number</span></span>
<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// Prepare the command</span>
  <span class="token keyword">const</span> command <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ChargeCreditCard</span><span class="token punctuation">(</span>creditCardId<span class="token punctuation">,</span> amount<span class="token punctuation">)</span>

  <span class="token comment">// Send it. @node-ts/bus-core will route it to wherever the handler is</span>
  <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>bus<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>command<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>A commands are sent to a single service for processing, and generally result in the publication of one or more <code>Events</code></p> <h2 id="event"><a href="#event" aria-hidden="true" class="header-anchor">#</a> Event</h2> <p>An event is a message emitted by the system when &quot;something&quot; happens. Again this could be a technical task being completed such as <code>DatabaseBackedup</code>, <code>LoadBalancerScaledOut</code> or as a result of changes in your business <code>CreditCardCharged</code>, <code>MerchandisePosted</code>.</p> <p>Past-tense should be used when naming an event, since it indicates that an operation was performed on your application.</p> <p>Events are class definitions that extend from <code>Event</code>, eg:</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Event <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@node-ts/bus-messages'</span>

<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">CreditCardCharged</span> <span class="token keyword">extends</span> <span class="token class-name">Event</span> <span class="token punctuation">{</span>
  <span class="token comment">/**
   * A unique name that identifies the message. This should be done in namespace style syntax,
   * ie: organisation/domain/event-name
   */</span>
  $name <span class="token operator">=</span> <span class="token string">'my-app/accounts/credit-card-charged'</span>

  <span class="token comment">/**
   * The contract version of this message. This can be incremented if this message changes the
   * number of properties etc to maintain backwards compatibility
   */</span>
  $version <span class="token operator">=</span> <span class="token number">1</span>

  <span class="token comment">/**
   * A credit card was successfully charged
   * @param creditCardId the card that was charged
   * @param amount the amount, in USD, the card was charged for
   */</span>
  <span class="token keyword">constructor</span> <span class="token punctuation">(</span>
    <span class="token parameter"><span class="token keyword">readonly</span> creditCardId<span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
    <span class="token keyword">readonly</span> amount<span class="token punctuation">:</span> <span class="token builtin">number</span></span>
  <span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>To publish an event, just use <code>bus.publish()</code>, eg:</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Bus <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@node-ts/bus-core'</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">creditCardChaged</span> <span class="token punctuation">(</span>
  <span class="token parameter">bus<span class="token punctuation">:</span> Bus<span class="token punctuation">,</span>
  creditCardId<span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
  amount<span class="token punctuation">:</span> <span class="token builtin">number</span></span>
<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// Prepare the event</span>
  <span class="token keyword">const</span> event <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CreditCardCharged</span><span class="token punctuation">(</span>creditCardId<span class="token punctuation">,</span> amount<span class="token punctuation">)</span>

  <span class="token comment">// Publish it. @node-ts/bus-core will route the event to all handlers subscribed to it</span>
  <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>bus<span class="token punctuation">.</span><span class="token function">publish</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="usage"><a href="#usage" aria-hidden="true" class="header-anchor">#</a> Usage</h2> <p>Modelling your system using messages like the ones above is very powerful. There are no concerns around what handles them or how they're processed - they just represent an intent to change the system (<code>command</code>) or that a change in the system has occurred (<code>event</code>).</p> <p>Over time the number of messages in your library will build up to describe the business domain you're modeling. The messages can be easily defined and well documented so that new developers can understand what they do without any technical detail, which encourages a well-documented system in code.</p></div> <div class="page-edit"><!----> <!----></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/bus/" class="prev router-link-active">
          Home
        </a></span> <span class="next"><a href="/bus/packages/bus-core/src/handler/">
          Handlers
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/bus/assets/js/app.a26ebe03.js" defer></script><script src="/bus/assets/js/9.25fc9bcf.js" defer></script>
  </body>
</html>
